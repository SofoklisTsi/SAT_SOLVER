# SAT Solver

This project is an implementation of a SAT (Boolean Satisfiability) solver using the **DPLL (Davis-Putnam-Logemann-Loveland)** algorithm in Python.

## Project Structure

SAT_SOLVER/
├── src/sat_solver
|   ├── Solver/
|   │   ├── dpll_solver.py                # DPLL algorithm implementation.
|   ├── SATProblems/
|   │   ├── sat_problem.py                # SAT problem representation.
|   │   ├── twl_sat_problem.py            # Two Watched Literals (TWL) SAT problem representation.
|   |   ├── true_twl_sat_problem,py       # True Two Watched Literals (TWL) SAT problem representation.
|   ├── Clause_Elimination_Methods/
|   │   └── clause_elimination_methods.py  # Clause elimination techniques (e.g., pure literal elimination).
|   ├── Heuristics/
|   │   ├── literal_count_branching_heuristics.py  # Literal count heuristics (Default, DLCS, DLIS, RDLCS, RDLIS).
|   │   └── moms_branching_heuristics.py           # MOM’s and RMOM’s heuristics.
|   ├── DIMACS_Reader/
|   │   └── clause_reader.py             # Logic for reading DIMACS CNF files.
|   ├── DATA/
|   │   ├── Clauses_Files/
|   │   │   ├── Clauses_Files_Results/
|   │   │   │   ├── PDFS_Results/       # Results for the pdf problems.
|   │   │   │   └── TESTS_Results/      # Testing results.
|   │   │   ├── PDFS/                   # SAT problem files in CNF format from the university's PDFs.
|   │   │   └── TESTS/                  # Test files created to test different aspects of the project.
|   │   ├── SATLIB/                     # Standard SAT problem instances from [SATLIB](https://www.cs.ubc.ca/~hoos/SATLIB/benchm.html).
|   │   │   ├── uf100-430/              
|   │   │   ├── uf125-538/              # Each folder contains 10 .cnf problems.
|   │   │   ├── uf150-645/
|   │   │   ├── uf20-91/
|   │   │   ├── uf250-1065/
|   │   │   └── uf75-325/
|   ├── Testers/
|   │   ├── profile_output.prof          # Profiling output that will be created by test_SATLIB.py.
|   │   ├── test_dpll_solver.py          # Unit tests for DPLL solver.
|   │   ├── test_SATLIB.py               # Unit tests for SATLIB instances and Profiling.
|   │   └── version_tester.py            # Version testing to ensure the functionality of the Solver after each change.
├── pyproject.toml                   # Poetry configuration file for dependencies and project settings.
├── poetry.lock                      # Dependency lockfile generated by Poetry.
├── .gitignore                       # Git ignore configuration.
└── README.md                        # Project documentation. This very file!


## Features

- **DPLL Algorithm**: Implements the DPLL algorithm with optional pure literal elimination and unit propagation.
- **Logging and Decision Table**: Logs each decision step, including decision literals, implied literals, satisfied/contradicted clauses, and explanations.
- **Configurable Options**: Includes settings for using or skipping pure literal elimination, different heuristics and two watched literals.
- **Unit Tests**: Basic tests for the solver using `test_dpll_solver.py`.
- **Version Tests**: A list of tests for testing the solvers functionality using `version_tester.py`.
- **Benchamarks Tester**: A list of the instance the solver can solver and the solvers profiling using `test_SATLIB.py`

### Phase 2.1: Literal Count Heuristics and Clause Elimination Preparation

- **Literal Count Heuristics**: Adds branching heuristics (DLCS, DLIS, RDLCS, RDLIS) based on literal counts to guide decision-making, improving solver efficiency.
- **Clause Elimination Preparation**: Moved `pure_literal_elimination` to `clause_elimination_methods.py`, establishing a modular structure for future clause elimination techniques.

### Phase 2.2: Add MOM’s Heuristics

- **MOM's Heuristic**: Implements the Maximum Occurrences on clauses of Minimum size (MOM's) heuristic, which selects literals based on their frequency in the smallest unsatisfied clauses. MOM's heuristic uses a formula to prioritize literals that occur frequently, controlled by the parameter `k`.
- **RMOM's Heuristic**: Randomized version of MOM's, assigning a randomly chosen truth value (True/False) to the selected literal.
- **Flexible `k` Parameter**: Allows the user to adjust the sensitivity of MOM's heuristic through the `k` parameter, which influences literal selection. 

### Phase 3.0: Two Watched Literals (TWL) Optimization

- **Two Watched Literals**: Implements the Two Watched Literals optimization to improve unit propagation efficiency. By monitoring only two literals in each clause, this approach minimizes the number of literals checked at each decision level, making the solver more efficient for larger problems.
- **Integration with DPLL**: When twl=True is enabled, the solver converts the SAT problem instance to use the Two Watched Literals technique, making it compatible with the existing DPLL logic.

### Phase 3.1: DIMACS Clause Form Compatibility and Code Refactoring

- **DIMACS Reader**: A class that processes DIMACS .cnf files, extracting the problem's clauses, the number of literals, and the number of clauses for use in the solver.
- **Performance Testing**: Utilized cProfile and SnakeViz to benchmark the solver's performance with various SATLIB problem instances. This phase helped identify performance bottlenecks and areas for optimization.
- **Code Refactoring**: Following the performance analysis, significant changes were made to the codebase to optimize the solver's efficiency. While these improvements enhanced performance, they resulted in a decrease in code readability. 
- **Enhanced Project Structure**: As the project expanded, the code was reorganized into dedicated directories and modules to maintain clarity and manageability. This restructuring ensures easier navigation and scalability for future development.
- **Decision Literal Bug Fixed**: A bug was identified where the decision literal printed in the 'decision literal' column of the 'steps' log had incorrect polarity when heuristics other than the 'default' were used. This issue has now been resolved.

### Phase 3.2: PyPy, Poetry, Pytest and Code Refactoring
- **Project's Directory Changes**: The codebase and data files have been reorganized to improve structure and scalability. All source code and related modules are now housed in the src/sat_solver directory.
- **True Two Watched Literals**: Introduced `TrueTWLSATProblem`, a novel variation of the Two Watched Literals (TWL) optimization. This implementation provides an alternative mechanism for managing watched literals, offering potential performance improvements for certain SAT problem instances.
- **PyPy**: Full compatibility with `PyPy 3.10` has been achieved. PyPy significantly enhances runtime performance, making the solver more efficient for larger or more complex SATLIB problems.
- **Poetry**: The project now leverages Poetry for dependency management, virtual environments, and packaging. Key benefits include:
    - Simplified dependency installation with the poetry install command.
    - Isolated environments for better control over package versions and compatibility.
    - Easy configuration through the pyproject.toml file, which also defines metadata like the project's name, version, and supported Python versions.
- **Pytest**: Testing workflows have been modernized with Pytest, enabling:
    - Parametrized tests for heuristics and features, ensuring comprehensive coverage.
    - Simplified test discovery and execution with the poetry run pytest command.
    - Integration of fixtures for reusable test setups, improving maintainability and readability.

## Requirements

- Python 3.10 (in order to be compatioble with PyPy)
- [Git](https://git-scm.com/) for version control
- [PyPy 3.10](https://www.pypy.org/) for enhanced performance (recommended).
- [Poetry](https://python-poetry.org/) for dependency and environment management.

## Setup

1. Clone the repository:
    ```bash
    git clone https://github.com/SofoklisTsi/SAT_SOLVER.git
    cd SAT_SOLVER
    ```

2. Install PyPy:
    Download PyPy 3.10 from the [official website](https://www.pypy.org/).

3. Install Poetry:
    Follow the [Poetry installation guide](https://python-poetry.org/docs/).

4. Configure PyPy and Poetry for the Project:
    ```bash
    poetry install
    poetry env use C:\PyPy\pypy3.10-v7.3.17-win64\pypy3.10.exe (or your path to pypy)

## Usage

1. To solve a SAT problem:
    ```python
    from SATPRoblems.sat_problem import SATProblem
    from Solver.dpll_solver import DPLLSolver

    clauses = [[1, -3], [-2, 3], [2, 4], [-4]]  # Example problem
    problem = SATProblem(clauses)
    solver = DPLLSolver(problem, use_pure_literal=True, heuristic='moms', k=2, twl=True)

    is_satisfiable = solver.solve()
    print("Satisfiable:", is_satisfiable)

    # Print decision steps (optional)
    solver.print_steps()
    ```

2. **Selecting Heuristics**:
   The solver supports multiple heuristics, which can be set via the `heuristic` parameter in `DPLLSolver`. Options include:
   - `'default'`: A simple first unassigned literal heuristic.
   - `'dlcs'`, `'dlis'`, `'rdlcs'`, `'rdlis'`: Literal count-based heuristics.
   - `'moms'`: MOM’s heuristic, with configurable `k` (e.g., `heuristic='moms', k=2`).
   - `'rmoms'`: RMOM’s heuristic, which randomizes the truth value of the selected literal (e.g., `heuristic='rmoms', k=2`).

3. **Two Watched Literals (TWL)**:
    To enable Two Watched Literals, pass twl=True when initializing DPLLSolver.

4. **Testing**:
   Run tests to verify the solver works correctly:
   ```bash
    poetry shell  # Activates the Poetry environment
    cd src/sat_solver
    pytest -v testers/version_tester.py  # Run tests
    pytest -v -s testers/version_tester.py  # Include logger output during test runs
    poetry exit # Exits the Poetry environment
   ```

5. **Performance Testing**:
   To test the solver's performance, use the test_SATLIB.py script. This will profile the solver's execution using cProfile, which can then be visualized with SnakeViz. To do so, run the following commands:
   ```bash
    poetry shell  # Activates the Poetry environment
    cd src/sat_solver
    pypy testers/test_SATLIB.py # Execute tests with PyPy for performance comparison
    snakeviz testers/profile_output.prof  # This opens a visualization of the profiling data
    poetry exit # Exits the Poetry environment
   ```

## Acknowledgements
A special thanks to the creator of the [Folder Mapper VSCode Extension](https://github.com/m0n0t0ny/Folder-Mapper-VSCode-Extension). This extension has been incredibly helpful in organizing and visualizing the project structure, as well as in explaining it to AI tools.
